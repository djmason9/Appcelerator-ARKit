var Alloy=require('/alloy'),Backbone=Alloy.Backbone,_=Alloy._,Controller=function(){function a(){return c.__widgetId?{widgetId:c.__widgetId,name:c.__controllerPath}:c.__controllerPath}var b=[],c=this;this.__iamalloy=!0,_.extend(this,Backbone.Events,{__views:{},__events:[],__proxyProperties:{},setParent:function(a){var c=b.length;if(c){this.parent=a.__iamalloy?a.parent:a;for(var d=0;d<c;d++)b[d].__iamalloy?b[d].setParent(this.parent):this.parent.add(b[d])}},addTopLevelView:function(a){b.push(a)},addProxyProperty:function(a,b){this.__proxyProperties[a]=b},removeProxyProperty:function(a){delete this.__proxyProperties[a]},getTopLevelViews:function(){return b},getView:function(a){return'undefined'==typeof a||null===a?b[0]:this.__views[a]},removeView:function(a){delete this[a],delete this.__views[a]},getProxyProperty:function(a){return this.__proxyProperties[a]},getViews:function(){return this.__views},destroy:function(){},getViewEx:function(a){var b=a.recurse||!1;if(b){var c=this.getView();return c?c.__iamalloy?c.getViewEx({recurse:!0}):c:null}return this.getView()},getProxyPropertyEx:function(a,b){var c=b.recurse||!1;if(c){var d=this.getProxyProperty(a);return d?d.__iamalloy?d.getProxyProperty(a,{recurse:!0}):d:null}return this.getView(a)},createStyle:function(b){return Alloy.createStyle(a(),b)},UI:{create:function(b,c){return Alloy.UI.create(a(),b,c)}},addClass:function(b,c,d){return Alloy.addClass(a(),b,c,d)},removeClass:function(b,c,d){return Alloy.removeClass(a(),b,c,d)},resetClass:function(b,c,d){return Alloy.resetClass(a(),b,c,d)},updateViews:function(a){var b=this.getViews();return _.isObject(a)&&_.each(_.keys(a),function(c){var d=b[c.substring(1)];0===c.indexOf('#')&&'#'!==c&&_.isObject(d)&&'function'==typeof d.applyProperties&&d.applyProperties(a[c])}),this},addListener:function(a,b,c){return!a.id&&(a.id=_.uniqueId('__trackId'),_.has(this.__views,a.id))?void Ti.API.error('$.addListener: '+a.id+' was conflict.'):(a.addEventListener(b,c),this.__events.push({id:a.id,view:a,type:b,handler:c}),a.id)},getListener:function(a,b){return _.filter(this.__events,function(c){return a&&a.id!==c.id||b&&b!==c.type?!1:!0})},removeListener:function(a,b,d){return _.each(this.__events,function(e,f){a&&a.id!==e.id||b&&b!==e.type||d&&d!==e.handler||(e.view.removeEventListener(e.type,e.handler),delete c.__events[f])}),this}})};module.exports=Controller;