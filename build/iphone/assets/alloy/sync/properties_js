var Alloy=require('/alloy'),_=require('/alloy/underscore')._,TAP=Ti.App.Properties;function S4(){return(0|65536*(1+Math.random())).toString(16).substring(1)}function guid(){return S4()+S4()+'-'+S4()+'-'+S4()+'-'+S4()+'-'+S4()+S4()+S4()}function Sync(a,b,c){var d=b.config.adapter.collection_name?b.config.adapter.collection_name:'default',e=new RegExp('^('+d+')\\-(.+)$'),f=null;if(!('read'===a))'create'===a||'update'===a?(b.id||(b.id=guid(),b.set(b.idAttribute,b.id)),TAP.setObject(d+'-'+b.id,b.toJSON()||{}),f=b.toJSON()):'delete'===a&&(TAP.removeProperty(d+'-'+b.id),b.clear(),f=b.toJSON());else if(b instanceof Backbone.Collection){var g=[];_.each(TAP.listProperties(),function(a){var b=a.match(e);null!==b&&g.push(TAP.getObject(a))}),f=g}else{var h=TAP.getObject(d+'-'+b.id);b.set(h),f=b.toJSON()}f?(_.isFunction(c.success)&&c.success(f),'read'===a&&b.trigger('fetch')):_.isFunction(c.error)&&c.error(f)}module.exports.sync=Sync,module.exports.beforeModelCreate=function(a){return a=a||{},a.columns=a.columns||{},a.defaults=a.defaults||{},('undefined'==typeof a.columns.id||null===a.columns.id)&&(a.columns.id='String'),a};