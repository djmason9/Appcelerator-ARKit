var _=require('/alloy/underscore')._;function S4(){return(0|65536*(1+Math.random())).toString(16).substring(1)}function guid(){return S4()+S4()+'-'+S4()+'-'+S4()+'-'+S4()+'-'+S4()+S4()+S4()}function InitAdapter(){throw'localStorage persistence supported only with MobileWeb.'}function Sync(a,b,c){function d(a){localStorage.setItem(e,JSON.stringify(a))}var e=b.config.adapter.collection_name,f=b.config.data,g=null;switch(a){case'create':b.id||(b.id=guid(),b.set(b.idAttribute,b.id)),f[b.id]=b,d(f),g=b.toJSON();break;case'read':var h=localStorage.getItem(e),i=h&&JSON.parse(h)||{},j=0;for(var k in i){var l=new b.config.Model(i[k]);b.models.push(l),j++}b.length=j,g=1==j?b.models[0]:b.models;break;case'update':f[b.id]=b,d(f),g=b.toJSON();break;case'delete':delete f[b.id],d(f),g=b.toJSON();}g?(_.isFunction(c.success)&&c.success(g),'read'===a&&b.trigger('fetch')):_.isFunction(c.error)&&c.error(g)}module.exports.sync=Sync,module.exports.beforeModelCreate=function(a){return a=a||{},a.data={},InitAdapter(),a},module.exports.afterModelCreate=function(a){return a=a||{},a.prototype.config.Model=a,a};